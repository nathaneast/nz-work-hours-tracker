# 프로젝트 규칙 및 컨텍스트 가이드

이 문서는 NZ Work Hours Tracker 프로젝트의 기획, 기술, 코드 스타일 규칙을 정의합니다. 모든 개발 작업은 이 규칙을 따라야 합니다.

## 📱 모바일 퍼스트 원칙

**가장 중요한 원칙: 이 프로젝트는 무조건 모바일 퍼스트입니다.**

### UI/UX 규칙
- 모든 UI 컴포넌트는 모바일 화면을 우선적으로 설계
- 모바일에서 각 화면 크기에 따라 이상하게 보이는 부분이 있으면 즉시 수정
- 반응형 디자인: `sm:`, `md:`, `lg:` 브레이크포인트 사용
- 터치 친화적: 버튼과 입력 필드는 최소 44px 터치 영역 확보
- 텍스트 줄바꿈: 모바일에서 긴 텍스트는 자동 줄바꿈 처리
- 입력 필드: 모바일에서 입력값이 잘 보이도록 충분한 너비 확보

### 모바일 최적화 체크리스트
- [ ] 모든 버튼이 모바일에서 쉽게 클릭 가능한가?
- [ ] 입력 필드의 값이 잘 보이는가?
- [ ] 텍스트가 화면 밖으로 넘어가지 않는가?
- [ ] 아이콘과 텍스트가 적절한 크기인가?
- [ ] 줄바꿈이 필요한 부분은 처리되었는가?

## 🎨 디자인 규칙

### 아이콘 사용
- 텍스트 버튼 대신 아이콘 사용 권장 (특히 모바일)
- 모든 아이콘은 `components/icons/` 디렉토리에 SVG 컴포넌트로 정의

### 레이아웃
- 모바일: 세로 스택 레이아웃 우선
- 데스크톱: 가로 배치 가능한 경우에만 사용
- 간격: `gap-2`, `gap-3`, `gap-4` 등 일관된 간격 사용

### 색상
- Primary: 프로젝트 메인 색상
- Secondary: 보조 색상
- Red: 세금, 차감 항목
- Blue/Green: 추가 항목, 긍정적 정보

## 💰 뉴질랜드 임금 계산 규칙

### Holiday Pay (8%)
- **계산 방식**: 총 임금(Ordinary Pay)의 8% 추가 지급
- **적용 조건**: Job의 `includeHolidayPay`가 `true`인 경우
- **공휴일 여부와 무관**: 모든 근무 시간에 대해 적용
- **표시**: PaySummary에서 "Holiday Pay (8%)"로 별도 표시

### Public Holiday Premium (1.5×)
- **계산 방식**: 공휴일 근무 시 기본 시급 × 1.5배
- **구성**: 기본 시급 + 추가 0.5× 프리미엄
- **표시**: PaySummary에서 "Public Holiday Premium (1.5×)"로 별도 표시
- **적용**: 공휴일로 지정된 날짜에 근무한 시간에만 적용

### 계산 순서
1. Ordinary Pay: 기본 시급 × 근무 시간 (공휴일 포함)
2. Public Holiday Premium: 공휴일 근무 시간 × 시급 × 0.5
3. Holiday Pay: Ordinary Pay × 8% (includeHolidayPay가 true인 Job만)
4. Gross Pay = Ordinary Pay + Public Holiday Premium + Holiday Pay

## ⏰ 시간 표시 규칙

### 입력 방식
- 사용자 입력: 시간과 분을 분리하여 입력 (예: 7h 30m)
- 내부 저장: 소수 형식으로 저장 (예: 7.5)

### 표시 방식
- **캘린더**: 
  - 시분 형식으로 표시 (예: 7h 30m)
  - 시분 모두 있을 때만 소수 표기 추가 표시 (작게)
- **주급 계산서**:
  - 시분 형식 + 소수 표기 (예: 7h 30m (7.50))
  - 시만 있을 때는 소수 표기 생략
  - "hrs", "h" 단위 제거 (소수 표기에서)

## 🗄️ 데이터베이스 규칙

### Supabase 사용
- 로그인한 사용자: Supabase에 저장
- 미로그인 사용자: localStorage 사용
- 모든 설정은 로그인 시 DB에 저장, 미로그인 시 localStorage 사용

### 테이블 구조
- `profiles`: 사용자 설정 (region, week_start_day)
- `jobs`: 작업 정보 (name, pay_rate, color, include_holiday_pay)
- `work_logs`: 근무 기록 (date, job_id, hours)

## 🧩 컴포넌트 구조

### 컴포넌트 위치
- `components/`: 재사용 가능한 UI 컴포넌트
- `components/icons/`: SVG 아이콘 컴포넌트
- `pages/`: 페이지 컴포넌트
- `hooks/`: 커스텀 훅
- `services/`: 비즈니스 로직 및 API 호출
- `utils/`: 유틸리티 함수

### 컴포넌트 네이밍
- PascalCase 사용 (예: `PaySummary`, `JobEditor`)
- 명확하고 설명적인 이름 사용
- Props 타입은 인터페이스로 정의

## 📝 코드 스타일

### TypeScript
- 모든 컴포넌트는 TypeScript로 작성
- 타입 정의는 `types.ts`에 중앙 집중
- `any` 타입 사용 금지

### React
- 함수형 컴포넌트 사용
- Hooks 사용 권장 (`useState`, `useEffect`, `useMemo`, `useCallback`)
- Props는 인터페이스로 타입 정의

### 스타일링
- Tailwind CSS 사용
- 인라인 클래스 사용
- 반응형: `sm:`, `md:`, `lg:` 프리픽스 사용

### 파일 구조
```
components/
  Calendar.tsx
  PaySummary.tsx
  JobEditor.tsx
  icons/
    SettingsIcon.tsx
    PlusIcon.tsx
    TrashIcon.tsx
```

## 🔄 Git 워크플로우

### 브랜치 전략
- `main`: 프로덕션 브랜치
- `develop`: 개발 브랜치
- 기능 개발은 `develop`에서 진행 후 `main`으로 머지

### 커밋 메시지
- 명확하고 설명적인 메시지 작성
- 변경 사항을 구체적으로 설명
- 예: "공휴일 근무 시 1.5배 시급 계산 및 시간 표시 형식 개선"

### 머지 전 체크리스트
- [ ] 모든 변경사항 커밋 완료
- [ ] Linter 오류 없음
- [ ] 모바일에서 UI 테스트 완료
- [ ] 계산 로직 정확성 확인

## 🧪 테스트 규칙

### 계산 로직 테스트
- 새로운 계산 로직 추가 시 반드시 테스트
- 실제 시나리오로 계산 검증 (예: 12월 23-29일 주간 테스트)
- 예상 값과 실제 값 비교

### UI 테스트
- 모바일 화면 크기별 테스트 필수
- 다양한 입력 값 테스트
- 공휴일 포함 시나리오 테스트

## 📚 문서화

### 코드 주석
- 복잡한 로직은 주석으로 설명
- 계산 공식은 주석으로 명시
- TODO는 `// TODO:` 형식으로 표시

### README 업데이트
- 새로운 기능 추가 시 README 업데이트
- Supabase 설정 변경 시 `SUPABASE_SETUP.md` 업데이트

## 🚨 주의사항

### 절대 하지 말아야 할 것
- 모바일 UI를 고려하지 않은 변경
- 계산 로직을 검증하지 않은 변경
- 타입 안정성을 무시한 변경
- 기존 동작을 깨뜨리는 변경

### 반드시 확인해야 할 것
- 모바일에서 UI가 정상적으로 보이는가?
- 계산 결과가 정확한가?
- 모든 타입이 올바른가?
- 기존 기능이 정상 작동하는가?

## 📖 컨텍스트 기억 방법

### 이 문서 활용
1. 새로운 기능 개발 전 이 문서 검토
2. UI 변경 시 "모바일 퍼스트 원칙" 확인
3. 계산 로직 변경 시 "뉴질랜드 임금 계산 규칙" 확인
4. 코드 작성 시 "코드 스타일" 섹션 참고

### 문서 업데이트
- 새로운 규칙 추가 시 이 문서 업데이트
- 기존 규칙 변경 시 이 문서 수정
- 모든 팀원이 이 문서를 참고하도록 안내

## 🔍 문제 해결 가이드

### UI 문제
1. 모바일 화면에서 확인
2. 반응형 클래스 확인 (`sm:`, `md:`, `lg:`)
3. 텍스트 줄바꿈 확인
4. 입력 필드 너비 확인

### 계산 문제
1. 계산 로직 확인 (`services/payCalculator.ts`)
2. 테스트 시나리오 작성
3. 예상 값과 실제 값 비교
4. Holiday Pay와 Public Holiday Premium 구분 확인

### 데이터 문제
1. 로그인 상태 확인
2. Supabase 연결 확인
3. localStorage 확인 (미로그인 시)
4. 데이터 타입 확인

---

**마지막 업데이트**: 2024-12-29
**유지보수**: 이 문서는 프로젝트와 함께 지속적으로 업데이트되어야 합니다.

